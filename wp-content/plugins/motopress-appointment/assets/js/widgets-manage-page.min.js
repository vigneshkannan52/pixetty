!function(){"use strict";!function(){class e{constructor(e,t={}){this.id=e,this.setupProperties(),this.setupValues(t)}setupProperties(){}setupValues(e){for(let t in e)this[t]=e[t]}getId(){return this.id}}class t extends e{setupProperties(){super.setupProperties(),this.name=""}}class i extends e{setupProperties(){super.setupProperties(),this.name=""}}function s(e,t){return e.filter((e=>-1!=t.indexOf(e)))}class r extends e{setupProperties(){super.setupProperties(),this.name="",this.price=0,this.depositType="disabled",this.depositAmount=0,this.duration=0,this.bufferTimeBefore=0,this.bufferTimeAfter=0,this.timeBeforeBooking=0,this.minCapacity=1,this.maxCapacity=1,this.multiplyPrice=!1,this.variations={},this.image="",this.thumbnail=""}getPrice(e=0,t=0){t||(t=this.minCapacity);let i=this.getVariation("price",e,this.price);return this.multiplyPrice&&(i*=t),i}getDuration(e=0){return this.getVariation("duration",e,this.duration)}getMinCapacity(e=0){return this.getVariation("min_capacity",e,this.minCapacity)}getMaxCapacity(e=0){return this.getVariation("max_capacity",e,this.maxCapacity)}getCapacityRange(e=0){return function(e,t,i=1){let s=i||1,r=Math.abs(Math.floor((t-e)/s))+1;return[...Array(r).keys()].map((t=>t*i+e))}(this.getMinCapacity(e),this.getMaxCapacity(e))}getMaxGuests(e=0){let t=this.getMaxCapacity(e)-this.getMinCapacity(e);return Math.max(0,t)}getVariation(e,t,i){return t in this.variations?this.variations[t][e]:i}}class a{static loadInBackground(e,t,i=!1){return t.findById(e.id,i).then((t=>{if(null!==t)for(let i in t)e[i]=t[i];return t}))}}let n="/motopress/appointment/v1";function o(e,t={}){return function(e,t={},i="GET"){return new Promise(((s,r)=>{wp.apiRequest({path:n+e,type:i,data:t}).done((e=>s(e))).fail(((e,t)=>{let i="parsererror";i=e.responseJSON&&e.responseJSON.message?e.responseJSON.message:`Status: ${t}`,"parsererror"==i&&(i="REST request failed. Maybe PHP error on the server side. Check PHP logs."),r(new Error(i))}))}))}(e,t,"GET")}class l{constructor(){this.settings=this.getDefaults(),this.loadingPromise=this.load()}getDefaults(){return{plugin_name:"Appointment Booking",today:"2030-01-01",business_name:"",default_time_step:30,default_booking_status:"confirmed",confirmation_mode:"auto",terms_page_id_for_acceptance:0,allow_multibooking:!1,allow_coupons:!1,allow_customer_account_creation:!1,country:"",currency:"EUR",currency_symbol:"&euro;",currency_position:"before",decimal_separator:".",thousand_separator:",",number_of_decimals:2,date_format:"F j, Y",time_format:"H:i",week_starts_on:0,thumbnail_size:{width:150,height:150},flatpickr_locale:"en",enable_payments:!1,active_gateways:[],payment_received_page_url:"",failed_transaction_page_url:"",default_payment_gateway:""}}load(){return new Promise(((e,t)=>{o("/settings").then((e=>this.settings=e),(e=>console.error("Unable to load public settings.",e))).finally((()=>e(this.settings)))}))}ready(){return this.loadingPromise}getPluginName(){return this.settings.plugin_name}getBusinessDate(){return this.settings.today}getBusinessName(){return this.settings.business_name}getTimeStep(){return this.settings.default_time_step}getDefaultBookingStatus(){return this.settings.default_booking_status}getConfirmationMode(){return this.settings.confirmation_mode}getTermsPageIdForAcceptance(){return this.settings.terms_page_id_for_acceptance}isMultibookingEnabled(){return this.settings.allow_multibooking}isCouponsEnabled(){return this.settings.allow_coupons}isAllowCustomerAccountCreation(){return this.settings.allow_customer_account_creation}getCountry(){return this.settings.country}getCurrency(){return this.settings.currency}getCurrencySymbol(){return this.settings.currency_symbol}getCurrencyPosition(){return this.settings.currency_position}getDecimalSeparator(){return this.settings.decimal_separator}getThousandSeparator(){return this.settings.thousand_separator}getDecimalsCount(){return this.settings.number_of_decimals}getDateFormat(){return this.settings.date_format}getTimeFormat(){return this.settings.time_format}getFirstDayOfWeek(){return this.settings.week_starts_on}getThumbnailSize(){return this.settings.thumbnail_size}getFlatpickrLocale(){return this.settings.flatpickr_locale}isPaymentsEnabled(){return this.settings.enable_payments}getActiveGateways(){return this.settings.active_gateways}getPaymentReceivedPageUrl(){return this.settings.payment_received_page_url}getFailedTransactionPageUrl(){return this.settings.failed_transaction_page_url}getDefaultPaymentGateway(){return this.settings.default_payment_gateway}}class h{constructor(){this.settingsCtrl=new l,this.loadingPromise=this.load()}load(){return Promise.all([this.settingsCtrl.ready()]).then((()=>this))}ready(){return this.loadingPromise}settings(){return this.settingsCtrl}static getInstance(){return null==h.instance&&(h.instance=new h),h.instance}}function u(){return h.getInstance()}const c="undefined"!=typeof wp&&wp.i18n&&wp.i18n.__?wp.i18n.__:(e,t="")=>e,p="undefined"!=typeof wp&&wp.i18n&&wp.i18n._x?wp.i18n._x:(e,t,i="")=>e,m="undefined"!=typeof wp&&wp.i18n&&wp.i18n.sprintf?wp.i18n.sprintf:(e,...t)=>{let i=0;return e.replace(/%([sdf])/g,((e,s)=>{if(i>=t.length)return e;let r=t[i++];switch(s){case"s":return String(r);case"d":return parseInt(r,10);case"f":return parseFloat(r);default:return e}}))},d={weekdays:{shorthand:[c("Sun","motopress-appointment"),c("Mon","motopress-appointment"),c("Tue","motopress-appointment"),c("Wed","motopress-appointment"),c("Thu","motopress-appointment"),c("Fri","motopress-appointment"),c("Sat","motopress-appointment")],longhand:[c("Sunday","motopress-appointment"),c("Monday","motopress-appointment"),c("Tuesday","motopress-appointment"),c("Wednesday","motopress-appointment"),c("Thursday","motopress-appointment"),c("Friday","motopress-appointment"),c("Saturday","motopress-appointment")]},months:{shorthand:[c("Jan","motopress-appointment"),c("Feb","motopress-appointment"),c("Mar","motopress-appointment"),c("Apr","motopress-appointment"),p("May","Month (short)","motopress-appointment"),c("Jun","motopress-appointment"),c("Jul","motopress-appointment"),c("Aug","motopress-appointment"),c("Sep","motopress-appointment"),c("Oct","motopress-appointment"),c("Nov","motopress-appointment"),c("Dec","motopress-appointment")],longhand:[c("January","motopress-appointment"),c("February","motopress-appointment"),c("March","motopress-appointment"),c("April","motopress-appointment"),p("May","Month","motopress-appointment"),c("June","motopress-appointment"),c("July","motopress-appointment"),c("August","motopress-appointment"),c("September","motopress-appointment"),c("October","motopress-appointment"),c("November","motopress-appointment"),c("December","motopress-appointment")]},amPM:["AM","PM"],firstDayOfWeek:u().settings().getFirstDayOfWeek()};function g(e,t="public"){if("string"==typeof e)return e;if("internal"==t)return g(e,"Y-m-d");if("public"==t)return g(e,u().settings().getDateFormat());let i=(e,t=2)=>("00"+e).slice(-t),s=!1;return t.split("").map((t=>{if(s)return s=!1,t;switch(t){case"\\":return s=!0,"";case"j":return e.getDate();case"d":return i(e.getDate());case"D":return d.weekdays.shorthand[e.getDay()];case"l":return d.weekdays.longhand[e.getDay()];case"N":return e.getDay()||7;case"w":return e.getDay();case"z":let r=new Date(e.getFullYear(),0,1),a=r.getTimezoneOffset()-e.getTimezoneOffset(),n=e-r+60*a*1e3,o=864e5;return Math.floor(n/o);case"W":let l=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),h=l.getUTCDay()||7;l.setUTCDate(l.getUTCDate()+4-h);let u=new Date(Date.UTC(l.getUTCFullYear(),0,1)),c=864e5;return Math.ceil(((l-u)/c+1)/7);case"F":return d.months.longhand[e.getMonth()];case"M":return d.months.shorthand[e.getMonth()];case"m":return i(e.getMonth()+1);case"n":return e.getMonth()+1;case"t":return new Date(e.getFullYear(),e.getMonth()+1,0).getDate();case"Y":return e.getFullYear();case"y":return String(e.getFullYear()).substring(2);case"L":return e.getFullYear()%4==0?1:0;case"A":return d.amPM[e.getHours()>11?1:0];case"a":return d.amPM[e.getHours()>11?1:0].toLowerCase();case"H":return i(e.getHours());case"h":return i(e.getHours()%12||12);case"G":return e.getHours();case"g":return e.getHours()%12||12;case"i":return i(e.getMinutes());case"s":return i(e.getSeconds());case"v":return i(e.getMilliseconds(),3);case"u":return i(e.getMilliseconds(),3)+"000";case"O":case"P":let p=-e.getTimezoneOffset(),m=p>=0?"+":"-",y=Math.floor(Math.abs(p)/60),f=Math.abs(p)%60,v="O"==t?"":":";return m+i(y)+v+i(f);case"Z":return 60*e.getTimezoneOffset();case"U":return Math.floor(e.getTime()/1e3);case"c":return g(e,"Y-m-d\\TH:i:sP");case"r":return g(e,"D, d M Y H:i:s O");case"S":case"o":case"B":case"e":case"T":case"I":return"";default:return t}})).join("")}function y(e){let t=e.match(/(\d{4})-(\d{2})-(\d{2})/);if(null!=t){let e=parseInt(t[1]),i=parseInt(t[2]),s=parseInt(t[3]);return new Date(e,i-1,s)}return null}function f(){let e=new Date;return e.setHours(0,0,0,0),e}class v extends e{setupProperties(){super.setupProperties(),this.status="new",this.code="",this.description="",this.type="fixed",this.amount=0,this.expirationDate=null,this.serviceIds=[],this.minDate=null,this.maxDate=null,this.usageLimit=0,this.usageCount=0}setupValues(e){for(let t of["expirationDate","minDate","maxDate"]){let i=e[t];null!=i&&""!==i&&(this[t]=y(i)),delete e[t]}super.setupValues(e)}getCode(){return this.code}isApplicableForCart(e){let t=!1;return e.items.forEach((e=>{if(this.isApplicableForCartItem(e))return t=!0,!1})),t}isApplicableForCartItem(e){return!!e.isSet()&&(!(this.serviceIds.length>0&&-1==this.serviceIds.indexOf(e.service.id))&&(!(null!=this.minDate&&e.date<this.minDate)&&!(null!=this.maxDate&&e.date>this.maxDate)))}calcDiscountAmount(e){let t=this.calcDiscountForCart(e);return Math.min(t,e.getSubtotalPrice())}calcDiscountForCart(e){let t=0;return e.items.forEach((e=>{t+=this.calcDiscountForCartItem(e)})),t}calcDiscountForCartItem(e){let t=0;if(this.isApplicableForCartItem(e)){let i=e.getPrice();switch(this.type){case"fixed":t=this.amount;break;case"percentage":t=i*this.amount/100}t=Math.min(t,i)}return t}}function b(e){let t=parseInt(e);return isNaN(t)?e<<0:t}class T{constructor(e){var t;this.postType=e,this.entityType=0===(t=e).indexOf("mpa_")?t.substring(4):0===t.indexOf("_mpa_")?t.substring(5):t,this.savedEntities={}}findById(e,t=!1){return e?!t&&this.haveEntity(e)&&null!=this.getEntity(e)?Promise.resolve(this.getEntity(e)):this.requestEntity(e).then((t=>{let i=this.mapRestDataToEntity(t);return this.saveEntity(e,i),i}),(t=>(this.saveEntity(e,null),null))):Promise.resolve(null)}findAll(e,t=!1){let i=[],s=[];for(let r of e)this.haveEntity(r)&&!t?s.push(this.getEntity(r)):i.push(r);return 0===i.length?Promise.resolve(s):this.requestEntities(i).then((e=>{for(let t of e){let e=this.mapRestDataToEntity(t);this.saveEntity(e.id,e),s.push(e)}return s}),(e=>[]))}requestEntity(e){return o(this.getRoute(),{id:e})}requestEntities(e){return o(this.getRoute(),{id:e})}haveEntity(e){return e in this.savedEntities}getEntity(e){return this.savedEntities[e]||null}saveEntity(e,t){this.savedEntities[e]=t}mapRestDataToEntity(e){return null}getRoute(){return`/${this.entityType}s`}}class w extends T{findByCode(e,t=!1){return o(this.getRoute(),{code:e}).then((e=>{let t=this.mapRestDataToEntity(e);return this.saveEntity(t.getId(),t),t}),(e=>{if(t)return null;throw e}))}mapRestDataToEntity(e){return new v(e.id,e)}}function _(e,t="public"){return g(e,"internal"==t?"H:i":"public"==t?u().settings().getTimeFormat():t)}class D{constructor(e,t=null){this.setupProperties(),null==t?this.parsePeriod(e):(this.setStartTime(e),this.setEndTime(t))}setupProperties(){this.startTime=null,this.endTime=null}parsePeriod(e){let t=e.split(" - ");this.setStartTime(t[0]),this.setEndTime(t[1])}setStartTime(e){this.startTime=this.convertToTime(e)}setEndTime(e){this.endTime=this.convertToTime(e)}convertToTime(e){return"string"==typeof e?function(e){let t=e.split(":"),i=parseInt(t[0]),s=parseInt(t[1]),r=f();return r.setHours(i,s),r}(e):new Date(e)}setDate(e){this.startTime.setFullYear(e.getFullYear()),this.startTime.setMonth(e.getMonth(),e.getDate()),this.endTime.setFullYear(e.getFullYear()),this.endTime.setMonth(e.getMonth(),e.getDate())}intersectsWith(e){return this.startTime<e.endTime&&this.endTime>e.startTime}isSubperiodOf(e){return this.startTime>=e.startTime&&this.endTime<=e.endTime}mergePeriod(e){this.startTime.setTime(Math.min(this.startTime.getTime(),e.startTime.getTime())),this.endTime.setTime(Math.max(this.endTime.getTime(),e.endTime.getTime()))}diffPeriod(e){this.startTime<e.startTime?this.endTime.setTime(Math.min(e.startTime.getTime(),this.endTime.getTime())):this.startTime.setTime(Math.max(e.endTime.getTime(),this.startTime.getTime()))}splitByPeriod(e){let t=[];return e.startTime.getTime()-this.startTime.getTime()>0&&t.push(new D(this.startTime,e.startTime)),this.endTime.getTime()-e.endTime.getTime()>0&&t.push(new D(e.endTime,this.endTime)),t}isEmpty(){return this.endTime.getTime()-this.startTime.getTime()<=0}toString(e="public",t=" - "){"internal"==e&&(t=" - ");let i="short"==e?"public":e,s=_(this.startTime,i),r=_(this.endTime,i);return"short"==e&&s==r?s:s+t+r}}class S extends e{setupProperties(){super.setupProperties(),this.serviceId=0,this.date=null,this.serviceTime=null,this.bufferTime=null}setupValues(e){for(let t in e)"date"==t?this.setDate(e[t]):"serviceTime"==t?this.setServiceTime(e[t]):"bufferTime"==t?this.setBufferTime(e[t]):this[t]=e[t]}setDate(e){this.date="string"==typeof e?y(e):e,null!=this.serviceTime&&this.serviceTime.setDate(this.date),null!=this.bufferTime&&this.bufferTime.setDate(this.date)}setServiceTime(e){this.serviceTime="string"==typeof e?new D(e):e,null!=this.date&&this.serviceTime.setDate(this.date)}setBufferTime(e){this.bufferTime="string"==typeof e?new D(e):e,null!=this.date&&this.bufferTime.setDate(this.date)}}class C extends T{findAllByService(e,t={}){let i={service_id:e};return null!=t.from_date&&(i.from_date=g(t.from_date,"internal")),null!=t.to_date&&(i.to_date=g(t.to_date,"internal")),o("/bookings/reservations",i).then((e=>{let t=[];for(let i of e){let e=this.mapRestDataToEntity(i);this.saveEntity(e.id,e),t.push(e)}return t})).catch((e=>(console.error("No reservations found.",e.message),[])))}mapRestDataToEntity(e){return new S(e.id,e)}}class P{constructor(e,t=null){this.setupProperties(),null==t?this.parsePeriod(e):(this.setStartDate(e),this.setEndDate(t))}setupProperties(){this.startDate=null,this.endDate=null}parsePeriod(e){let t=e.split(" - ");this.setStartDate(t[0]),this.setEndDate(t[1])}setStartDate(e){this.startDate=this.convertToDate(e)}setEndDate(e){this.endDate=this.convertToDate(e)}convertToDate(e){return"string"==typeof e?y(e)||f():new Date(e)}calcDays(){let e=this.endDate.getTime()-this.startDate.getTime();return Math.round(e/1e3/3600/24)}inPeriod(e){return"string"==typeof e&&(e=y(e)),null!=e&&e>=this.startDate&&e<=this.endDate}splitToDates(){let e={};for(let t=new Date(this.startDate);t<=this.endDate;t.setDate(t.getDate()+1)){let i=g(t,"internal"),s=new Date(t);e[i]=s}return e}toString(){return g(this.startDate,"internal")+" - "+g(this.endDate,"internal")}}class k extends e{setupProperties(){super.setupProperties(),this.timetable=[],this.workTimetable=[],this.customWorkdays=[],this.daysOff={}}setupValues(e){for(let t in e)"timetable"==t?this.setTimetable(e[t]):"customWorkdays"==t?this.setCustomWorkdays(e[t]):"daysOff"==t?this.setDaysOff(e[t]):this[t]=e[t]}setTimetable(e){this.timetable=[],this.workTimetable=[],e.forEach((e=>{let t=[],i=[];e.forEach((e=>{let s=new D(e.time_period);t.push({time_period:s,location:e.location,activity:e.activity}),"work"==e.activity&&i.push({time_period:s,location:e.location})})),this.timetable.push(t),this.workTimetable.push(i)}))}setCustomWorkdays(e){this.customWorkdays=[];for(let t of e)this.customWorkdays.push({date_period:new P(t.date_period),time_period:new D(t.time_period)})}setDaysOff(e){this.daysOff={};for(let t of e){let e=new P(t).splitToDates();jQuery.extend(this.daysOff,e)}}isDayOff(e){return"string"!=typeof e&&(e=g(e,"internal")),e in this.daysOff}getWorkingHours(e,t=0){if(this.isDayOff(e))return[];if("string"==typeof e&&(e=y(e)),null==e)return[];let i=[],s=e.getDay();for(let e of this.workTimetable[s])0!=t&&e.location!=t||i.push(e.time_period);for(let t of this.customWorkdays)t.date_period.inPeriod(e)&&i.push(t.time_period);return i}}class E extends T{mapRestDataToEntity(e){return new k(e.id,e)}}class I extends T{mapRestDataToEntity(e){return new r(e.id,e)}}class A{constructor(){this.repositories={}}schedule(){return null==this.repositories.schedule&&(this.repositories.schedule=new E("mpa_schedule")),this.repositories.schedule}service(){return null==this.repositories.service&&(this.repositories.service=new I("mpa_service")),this.repositories.service}reservation(){return null==this.repositories.reservation&&(this.repositories.reservation=new C("mpa_reservation")),this.repositories.reservation}coupon(){return null==this.repositories.coupon&&(this.repositories.coupon=new w("mpa_coupon")),this.repositories.coupon}customer(){return void 0===this.repositories.customer&&(this.repositories.customer=new CustomerRepository),this.repositories.customer}static getInstance(){return null==A.instance&&(A.instance=new A),A.instance}}let O=null;function M(e){return function(e){return!!e}(e)}function x(e,t=!1){return"object"==typeof e?0==function(e,t=!1){return"object"==typeof e?Array.isArray(e)?e.length:Object.keys(e).length:t?0:1}(e):!!t||!e}class ${setupProperties(){this.availability={},this.services={},this.serviceCategories={},this.employees={},this.locations={},this.readyPromise=null}constructor(e=!1){this.setupProperties(),this.readyPromise=function(e=!1){return(e||null==O)&&(O=o("/services/available").catch((e=>(console.error("Unable to extract available services."),{})))),O}(e).then((e=>(this.setAvailability(e),this)))}setAvailability(e){this.availability=e;for(let t in e){let i=e[t];this.services[t]=i.name;for(let e in i.categories){let t=i.categories[e];this.serviceCategories[e]=t}for(let e in i.employees){let t=i.employees[e];this.employees[e]=t.name;for(let e in t.locations){let i=t.locations[e];this.locations[e]=i}}}}isEmpty(){return x(this.availability)}ready(){return this.readyPromise}getService(e,t=!0,i=null){let s=new r(e);return this.services.hasOwnProperty(e)&&(s.name=this.services[e]),!0===t&&a.loadInBackground(s,A.getInstance().service()).then(i),s}getServiceCategories(e){return this.availability[e].categories}getEmployee(e){let i=new t(e);return this.employees.hasOwnProperty(e)&&(i.name=this.employees[e]),i}getLocation(e){let t=new i(e);return this.locations.hasOwnProperty(e)&&(t.name=this.locations[e]),t}getAvailableServices(e="",t=0,i=0){let s={};for(let r in this.availability){let a=this.availability[r];if(""===e||e in a.categories){if(0!==t){let e=!1;if(Object.keys(a.employees).forEach((i=>{a.employees[i].locations.hasOwnProperty(t)&&(e=!0)})),!e)continue}(0===i||i in a.employees)&&(s[r]=a.name)}}return s}getAvailableServiceCategories(e=0){let t={};for(let i in this.availability){if(0!=e&&i!=e)continue;let s=this.availability[i];jQuery.extend(t,s.categories)}return t}getAvailableEmployees(e=0,t=0){let i={};for(let s in this.availability){if(0!=e&&s!=e)continue;let r=this.availability[s];for(let e in r.employees){let s=r.employees[e];(0===t||t in s.locations)&&(i[e]=s.name)}}return i}getAvailableLocations(e=0,t=0){let i={};for(let s in this.availability){if(0!=e&&s!=e)continue;let r=this.availability[s];for(let e in r.employees){if(0!=t&&e!=t)continue;let s=r.employees[e];jQuery.extend(i,s.locations)}}return i}isAvailableServiceCategory(e){return this.getAvailableServiceCategories().hasOwnProperty(e)}isAvailableService(e){return this.getAvailableServices().hasOwnProperty(e)}isAvailableLocation(e){return this.getAvailableLocations().hasOwnProperty(e)}isAvailableEmployee(e){return this.getAvailableEmployees().hasOwnProperty(e)}filterAvailableEmployees(e,t=0,i="ids"){if(!(e in this.availability))return[];let r=[];Array.isArray(t)?r=t.filter(M):0!==t&&r.push(t);let a=[];for(let t in this.availability[e].employees){t=b(t);let i=this.availability[e].employees[t];if(0===r.length)a.push(t);else{s(r,Object.keys(i.locations).map(b)).length>0&&a.push(t)}}return 0===a.length?[]:"entities"===i?a.map((e=>this.getEmployee(e))):a}filterAvailableLocations(e,t=0,i="ids"){if(!(e in this.availability))return[];let s=[];Array.isArray(t)?s=t.filter(M):0!==t&&s.push(t);let r=[];for(t in this.availability[e].employees){if(t=b(t),s.length>0&&-1===s.indexOf(t))continue;let i=this.availability[e].employees[t];for(let e in i.locations)r.push(b(e))}return r=r.filter(((e,t,i)=>i.indexOf(e)===t)),0===r.length?[]:"entities"===i?r.map((e=>this.getLocation(e))):r}}function F(e,t,i=!1){let s="";return s='<option value="'+e+'"'+(i?' selected="selected"':"")+">",s+=t,s+="</option>",s}function L(e,t){let i="";for(let s in e)i+=F(s,e[s],s==t);return i}function W(e,t,i,s){let r=L(t,s)+L(i,s);e.empty().append(r).val(s)}class B{constructor(e,t){this.availability=t,this.availability.ready().finally((()=>{this.availability.getAvailableServiceCategories(),this.availability.getAvailableServices(),this.availability.getAvailableEmployees(),this.availability.getAvailableLocations(),this.defaultValuesDependency()})),this.widgetName="appointment_form",this.$widget=jQuery(e),this.widgetId=this.$widget.find('input[name="widget-id"]').val(),this.widgetInstanceNumber=this.widgetId.split("-").pop(),this.widgetFieldSelectorTemplate="#widget-"+this.widgetName+"-"+this.widgetInstanceNumber+"-",this.$showItemsCategory=this.findWidgetFieldElement("show_items-category"),this.$showItemsCategoryLabel=this.$showItemsCategory.parent(),this.$showItemsService=this.findWidgetFieldElement("show_items-service"),this.$showItemsServiceLabel=this.$showItemsService.parent(),this.$defaultCategory=this.findWidgetFieldElement("default_category"),this.$defaultService=this.findWidgetFieldElement("default_service"),this.$defaultLocation=this.findWidgetFieldElement("default_location"),this.$defaultEmployee=this.findWidgetFieldElement("default_employee"),this.showItemsCategoryProp=this.$showItemsCategory.prop("checked"),this.showItemsCategoryLabelTooltipText=m(c("To enable this option, you need to check the '%s' box.","motopress-appointment"),c("Service","motopress-appointment")),this.showItemsServiceLabelTooltipText=c("To enable booking for the specific service only, select the service below first, then uncheck the 'Service' box here.","motopress-appointment"),this.dependencyOfShowServiceToDefaultValueOfService(),this.toggleCategoryBasedOnService(),this.addListeners()}toggleLockCheckbox(e,t){const i=jQuery(`label[for="${e.attr("id")}"]`);t?(e.on("click.preventClick",(function(e){e.preventDefault()})),e.data("locked",!0),e.css({opacity:.6,cursor:"not-allowed"}),i.css("opacity",.6)):(e.off("click.preventClick"),e.removeData("locked"),e.css({opacity:1,cursor:"default"}),i.css("opacity",1))}isLockedCheckbox(e){return!!e.data("locked")}findWidgetFieldElement(e){return this.$widget.find(this.widgetFieldSelectorTemplate+e)}addListeners(){this.$showItemsCategory.on("change",(()=>this.updateShowItemsCategoryProp())),this.$showItemsService.on("change",(()=>this.toggleCategoryBasedOnService())),this.$defaultService.on("change",(()=>this.dependencyOfShowServiceToDefaultValueOfService())),this.$showItemsServiceLabel.on("click",(()=>this.makeFocusToServiceSelect())),this.$defaultCategory.on("change",(()=>this.defaultValuesDependency())),this.$defaultService.on("change",(()=>this.defaultValuesDependency())),this.$defaultLocation.on("change",(()=>this.defaultValuesDependency())),this.$defaultEmployee.on("change",(()=>this.defaultValuesDependency()))}updateShowItemsCategoryProp(){this.showItemsCategoryProp=this.$showItemsCategory.prop("checked")}toggleCategoryBasedOnService(){!1===this.$showItemsService.prop("checked")?(this.toggleLockCheckbox(this.$showItemsCategory,!0),this.$showItemsCategory.prop("checked",!1),this.$showItemsCategoryLabel.toggleClass("mpa_tooltip",!0),this.$showItemsCategoryLabel.attr("data-tooltip",this.showItemsCategoryLabelTooltipText)):(this.toggleLockCheckbox(this.$showItemsCategory,!1),this.$showItemsCategory.prop("checked",this.showItemsCategoryProp),this.$showItemsCategoryLabel.toggleClass("mpa_tooltip",!1))}dependencyOfShowServiceToDefaultValueOfService(){this.$defaultService.val()&&"0"!==this.$defaultService.val()?(this.toggleLockCheckbox(this.$showItemsService,!1),this.$showItemsServiceLabel.toggleClass("mpa_tooltip",!1),this.$showItemsServiceLabel.removeAttr("data-tooltip")):(this.toggleLockCheckbox(this.$showItemsService,!0),this.$showItemsService.prop("checked",!0),this.$showItemsServiceLabel.toggleClass("mpa_tooltip",!0),this.$showItemsServiceLabel.attr("data-tooltip",this.showItemsServiceLabelTooltipText))}makeFocusToServiceSelect(){!0===this.isLockedCheckbox(this.$showItemsService)&&this.$defaultService.focus()}defaultValuesDependency(){const e=jQuery("#_mpa_label_unselected").val(),t=e||c("— Select —","motopress-appointment"),i=jQuery("#_mpa_label_option").val(),s=i||c("— Any —","motopress-appointment"),r=this.$defaultCategory.val(),a=b(this.$defaultService.val()),n=b(this.$defaultEmployee.val()),o=b(this.$defaultLocation.val()),l=this.availability.isAvailableService(a)?a:0,h=this.availability.isAvailableServiceCategory(r)?r:"",u=this.availability.isAvailableLocation(o)?o:0,p=this.availability.isAvailableEmployee(n)?n:0,m=this.availability.getAvailableServiceCategories(l),d=this.availability.getAvailableServices(h,u,p),g=this.availability.getAvailableLocations(l,p),y=this.availability.getAvailableEmployees(l,u);W(this.$defaultCategory,{"":s},m,m.hasOwnProperty(h)?h:""),W(this.$defaultService,{0:t},d,d.hasOwnProperty(l)?l:0),W(this.$defaultLocation,{0:s},g,g.hasOwnProperty(u)?u:0),W(this.$defaultEmployee,{0:s},y,y.hasOwnProperty(p)?p:0)}}jQuery(document).ready((function(){const e=new $;e.ready().finally((()=>{e.getAvailableServiceCategories(),e.getAvailableServices(),e.getAvailableEmployees(),e.getAvailableLocations()})),jQuery('.widget[id*="appointment_form"]').not('[id*="__i__"]').each((function(){new B(this,e)})),jQuery(document).on("widget-added widget-updated",(function(t,i){"appointment_form"===i.find('input[name="id_base"]').val()&&new B(i,e)}))}))}()}();
