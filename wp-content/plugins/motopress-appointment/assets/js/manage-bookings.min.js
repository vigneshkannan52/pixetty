!function(){"use strict";!function(a){const t=a(".mpa-export-button"),e=a(".mpa-cancel-export-button"),o=a(".mpa-export-progress-bar");let s=!1,r=!1,d=!1;function i(n="get_status"){let c={action:"mpa_export_bookings",wp_nonce:mpaAjaxData.wpNonces.mpa_export_bookings,command:n};"start"===n&&(t.attr("data-booking_status")&&(c.booking_status=t.attr("data-booking_status")),t.attr("data-service_date_from")&&(c.service_date_from=t.attr("data-service_date_from")),t.attr("data-service_date_to")&&(c.service_date_to=t.attr("data-service_date_to")),t.attr("data-service_id")&&(c.service_id=t.attr("data-service_id")),t.attr("data-employee_id")&&(c.employee_id=t.attr("data-employee_id")),t.attr("data-location_id")&&(c.location_id=t.attr("data-location_id"))),console.log("REQUEST: ",c),a.ajax({url:mpaAjaxData.ajaxUrl,type:"POST",dataType:"json",data:c,success:function(a){s=!1,r=!1,console.log("RESPONSE DATA: ",a.data),"canceled"===a.data.status||"finished"===a.data.status&&!a.data.exportFileUrl?(t.removeClass("mpa-hide"),e.addClass("mpa-hide"),o.addClass("mpa-hide")):(t.addClass("mpa-hide"),e.removeClass("mpa-hide"),o.removeClass("mpa-hide"),o.val(a.data.percentage),o.html(a.data.percentage+"%"),"finished"===a.data.status&&a.data.exportFileUrl?(t.removeClass("mpa-hide"),e.addClass("mpa-hide"),o.addClass("mpa-hide"),d||(d=!0,window.location=a.data.exportFileUrl)):"finished"!==a.data.status&&"canceled"!==a.data.status&&("start"===n?i():setTimeout((()=>{i()}),3e3)))},error:a=>{s=!1,r=!1,void 0!==a.responseJSON&&void 0!==a.responseJSON.data.errorMessage?console.error(a.responseJSON.data.errorMessage):console.error(a)}})}t.click((a=>{a.stopPropagation(),a.preventDefault(),s||(s=!0,d=!1,i("start"))})),e.click((a=>{a.stopPropagation(),a.preventDefault(),r||(r=!0,i("cancel"))})),i()}(jQuery)}();
